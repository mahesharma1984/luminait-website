<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio: The Giver Annotation</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Scene Specific Overrides */
        .document-layer {
            background-image: url('assets/giver-ch1.jpg');
            /* Start zoomed out slightly or full view */
            transform: scale(1) translate(0, 0);
            transform-origin: top left;
        }

        /* Highlight Positioning (Absolute % based to scale with image) 
           Note: We use a wrapper svg for the strokes
        */
        .svg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* Specific Labels */
        #label-mood {
            top: 28%;
            left: 65%;
        }
    </style>
</head>

<body>

    <div class="stage">
        <div class="document-layer" id="doc"></div>

        <!-- Highlight Layer -->
        <svg class="svg-overlay" id="highlights" viewBox="0 0 1400 900" preserveAspectRatio="xMidYMid slice">
            <!-- Path for "frightened" (approx coords need tuning) -->
            <!-- We will inject these dynamically or toggle classes -->

            <!-- Highlight 1: "frightened" (Line ~20 of text) -->
            <path id="stroke-1" class="highlighter-path" d="M 230 480 L 380 480" />

            <!-- Highlight 2: "Almost December" -->
            <path id="stroke-2" class="highlighter-path" d="M 230 180 L 450 180"
                style="stroke: rgba(100, 200, 255, 0.5);" />
        </svg>

        <!-- Labels -->
        <div class="overlay-layer">
            <div class="annotation-layer">
                <div id="label-mood" class="annotation-label">
                    <span
                        style="display:block; font-size: 0.8em; color: #888; text-transform: uppercase; letter-spacing: 1px;">The
                        Hook</span>
                    Emotional Stakes established<br>before plot begins.
                </div>
            </div>
        </div>

        <!-- Debug Info -->
        <div id="step-debug" class="controls-hint">Step: 0</div>
    </div>

    <script src="script.js"></script>
    <script>
        const doc = document.getElementById('doc');
        const stroke1 = document.getElementById('stroke-1');
        const stroke2 = document.getElementById('stroke-2');
        const labelMood = document.getElementById('label-mood');

        // Reset state
        function reset() {
            doc.style.transform = "scale(1)";
            stroke1.style.strokeDashoffset = 1000;
            stroke2.style.strokeDashoffset = 1000;
            stroke1.classList.remove('draw-stroke');
            stroke2.classList.remove('draw-stroke');
            labelMood.classList.remove('show');
        }

        // Init
        reset();

        window.addEventListener('studio-step', (e) => {
            const step = e.detail.step;

            switch (step) {
                case 0:
                    reset();
                    break;
                case 1:
                    // Zoom into first paragraph ("It was almost December...")
                    // Coords approx based on top-left
                    doc.style.transform = "scale(2) translate(-10%, -15%)";
                    break;
                case 2:
                    // Highlight "almost December"
                    // Drawing logic: need to align path with zoom. Svg is overlay, so it doesn't zoom WITH doc by default unless inside.
                    // Actually, simpler to put SVG INSIDE doc layer if we want it to stick?
                    // OR: Adjust SVG transform to match document. 
                    // Let's try putting SVG inside document-layer for perfect scaling.
                    // REFACTORING DOM BELOW IN SCRIPT
                    break;
            }
        });

        // REFACTOR: Move SVG inside Doc Layer so it zooms with the text
        const svg = document.getElementById('highlights');
        const labels = document.querySelector('.annotation-layer');

        doc.appendChild(svg);
        doc.appendChild(labels);

        // Re-listen with corrected DOM
        window.addEventListener('studio-step', (e) => {
            const step = e.detail.step;

            // Adjust SVG paths based on the image content logic (Mocked coordinates for now)
            // Assuming image is ~1000px wide. 
            // "It was almost December" is top left.
            // "Frightened" is lower down.

            if (step === 1) {
                // Focus / Zoom
                doc.style.transform = "scale(1.8) translate(-100px, -100px)";
                // Reset others
                stroke1.classList.remove('draw-stroke');
                labelMood.classList.remove('show');
            }
            if (step === 2) {
                // Highlight "December"
                stroke2.classList.add('draw-stroke');
            }
            if (step === 3) {
                // Show label
                // labelMood.classList.add('show');
            }
            if (step === 4) {
                // Pan down to "Frightened"
                doc.style.transform = "scale(1.8) translate(-100px, -400px)";
            }
            if (step === 5) {
                // Highlight Frightened
                stroke1.classList.add('draw-stroke');
            }
            if (step === 6) {
                // Label Frightened
                labelMood.innerHTML = "<span style='display:block; font-size: 0.8em; color: #888; text-transform: uppercase; letter-spacing: 1px;'>Word Choice</span>Adjective 'Frightened' introduces<br>dismay/fear immediately.";
                labelMood.style.top = "55%"; // Adjust for zoomed coordinate
                labelMood.style.left = "40%";
                labelMood.classList.add('show');
            }
        });

    </script>
</body>

</html>